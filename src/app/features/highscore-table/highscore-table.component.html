<div class="highscore-container">
  <div class="highscore-header">
    <h2 class="highscore-title">
      {{ section() | titlecase }} Highscore
      <app-loading-spinner [visible]="loading()" />
    </h2>

    <div class="header-controls">
      <p-floatlabel variant="on">
        <input
          pInputText
          pSize="small"
          type="text"
          autocomplete="off"
          (input)="onFilterGlobal($any($event.target).value)"
        />
        <label for="search_character_table">Search by name</label>
      </p-floatlabel>

      <p-selectButton
        [options]="periodOptions"
        [(ngModel)]="selectedPeriodValue"
        (onChange)="onPeriodChange($event.value)"
        optionLabel="label"
        optionValue="value"
      />
    </div>
  </div>

  <!-- Error message -->
  @if (error()) {
    <p-message severity="error" [text]="error()!" />
  }

  <!-- Data table -->
  @if (!loading() || data().length > 0) {
    <p-table
      #dt
      class="p-datatable-sm"
      stripedRows
      [value]="data()"
      [scrollable]="true"
      [globalFilterFields]="['name']"
      scrollHeight="calc(100vh - 200px)"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name">Name</th>
          <th pSortableColumn="vocation">Vocation</th>
          <th pSortableColumn="level">Level</th>
          <th pSortableColumn="points">Experience</th>
          <th pSortableColumn="gain_points">Gain Experience</th>
          <th pSortableColumn="gain_level">Gain Level</th>
          <th pSortableColumn="gain_rank">Gain Rank</th>
          <th pSortableColumn="scrape_date">Date</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-record>
        <tr>
          <td>
            <strong>{{ record.name }}</strong>
          </td>
          <td>{{ record.vocation }}</td>
          <td>{{ record.level }}</td>
          <td>{{ formatPoints(record.points) }}</td>
          <td>{{ formatGain(record.gain_points) }}</td>
          <td>{{ formatGain(record.gain_level) }}</td>
          <td>{{ formatGain(record.gain_rank) }}</td>
          <td>{{ formatDate(record.scrape_date) }}</td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="9" style="text-align: center">No data available</td>
        </tr>
      </ng-template>
    </p-table>
  }
</div>
